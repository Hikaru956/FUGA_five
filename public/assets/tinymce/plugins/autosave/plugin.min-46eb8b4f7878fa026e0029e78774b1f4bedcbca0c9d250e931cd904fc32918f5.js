tinymce.PluginManager.add("autosave",function(e){function t(e,t){var a={s:1e3,m:6e4};return((e=/^(\d+)([ms]?)$/.exec(""+(e||t)))[2]?a[e[2]]:1)*parseInt(e,10)}function a(){var e=parseInt(l.getItem(d+"time"),10)||0;return!((new Date).getTime()-e>v.autosave_retention)||(n(!1),!1)}function n(t){l.removeItem(d+"draft"),l.removeItem(d+"time"),!1!==t&&e.fire("RemoveDraft")}function r(){c()||(l.setItem(d+"draft",e.getContent({format:"raw",no_events:!0})),l.setItem(d+"time",(new Date).getTime()),e.fire("StoreDraft"))}function o(){a()&&(e.setContent(l.getItem(d+"draft"),{format:"raw"}),e.fire("RestoreDraft"))}function i(){m||(setInterval(function(){e.removed||r()},v.autosave_interval),m=!0)}function s(){var t=this;t.disabled(!a()),e.on("StoreDraft RestoreDraft RemoveDraft",function(){t.disabled(!a())}),i()}function u(){e.undoManager.beforeChange(),o(),n(),e.undoManager.add()}function f(){var e;return tinymce.each(tinymce.editors,function(t){t.plugins.autosave&&t.plugins.autosave.storeDraft(),!e&&t.isDirty()&&t.getParam("autosave_ask_before_unload",!0)&&(e=t.translate("You have unsaved changes are you sure you want to navigate away?"))}),e}function c(t){var a=e.settings.forced_root_block;return""===(t=tinymce.trim(void 0===t?e.getBody().innerHTML:t))||new RegExp("^<"+a+"[^>]*>((\xa0|&nbsp;|[ \t]|<br[^>]*>)+?|)</"+a+">|<br>$","i").test(t)}var d,m,v=e.settings,l=tinymce.util.LocalStorage;d=(d=(d=(d=v.autosave_prefix||"tinymce-autosave-{path}{query}-{id}-").replace(/\{path\}/g,document.location.pathname)).replace(/\{query\}/g,document.location.search)).replace(/\{id\}/g,e.id),v.autosave_interval=t(v.autosave_interval,"30s"),v.autosave_retention=t(v.autosave_retention,"20m"),e.addButton("restoredraft",{title:"Restore last draft",onclick:u,onPostRender:s}),e.addMenuItem("restoredraft",{text:"Restore last draft",onclick:u,onPostRender:s,context:"file"}),!1!==e.settings.autosave_restore_when_empty&&(e.on("init",function(){a()&&c()&&o()}),e.on("saveContent",function(){n()})),window.onbeforeunload=f,this.hasDraft=a,this.storeDraft=r,this.restoreDraft=o,this.removeDraft=n,this.isEmpty=c});