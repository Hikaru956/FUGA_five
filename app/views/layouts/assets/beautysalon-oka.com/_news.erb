<%
    widget_bag = VisualWidget.search_widget_bag_for(@website, "019f5220ad639b33bee679b6252eff39")
    if widget_bag.blank? || !widget_bag.is_valid?
        cmax = 1
    else
        cmax = widget_bag.data_string.to_i
    end
    if cmax < 0 || cmax > 32
        cmax = 1
    end
    if cmax != 0

        @max = cmax
        type_root = ContentCategory.type_root(@website, ContentCategory::TYPE_NEWS)
        navigation = type_root.web_page
        bag_categories = type_root.children.where("is_public=?", true) #type_root.children.where('is_public=?', true)

        public_categories  = []
        bag_categories.each do | cat |
            public_categories.concat(cat.sons)
            public_categories << cat
        end
        latest_leafs = @website.public_leafs
        latest_leafs = latest_leafs.where("content_category_id IN (?)", public_categories).order(publish_from: :desc).limit(@max)

        #c = ContentLeaf.public_leafs
        #c.and "content_category_id", public_categories
        #latest_leafs =  @website.content_leafs.find(:all, :limit=>@max, :conditions=>c.where, :order=>'publish_from desc')
%>
<%      unless latest_leafs.blank? %>
<%
            latest_leafs.each do | leaf |
%>
    <aside class="top-news">
<%= raw leaf.description %>
    </aside>
<%          end %>
<%      end %>
<%
    end
%>
