<!-- === Masthead === -->
<ul class="breadcrumb">
  <li><%= link_to "トップ", :action=>"content_root" %>&nbsp;<span class="divider">/</span></li>
  <% ancs = @current_category.ancestors.reverse %>
  <% ancs.each do |cat| %>
    <% next if cat.category_type < 100 %>
    <li><%= link_to cat.category_label, :action=>"content_category_tree", :id=>cat %>&nbsp;<span class="divider">/</span></li>
  <% end %>
  <li class="active"><%= @current_category.category_label%></li>
</ul>

<header class="subhead" id="overview">
	<div class="float-right">
		<a class="btn btn-small btn-secondary" href="<%=url_for(:action=>"content_category", :id=>@parent_category)%>">
			<%= backward_icon('戻る') %>&nbsp;戻る</a>
	</div>
	<h3><%= @current_category.category_label %> : カテゴリー編集</h3>
</header>

<hr/>

<div>
	<span class='float-right'>
		<button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalNew">
			<%= new_icon('登録') %>&nbsp;新規登録
		</button>
	</span>
</div>

<div class="modal fade" id="modalNew" tabindex="-1" aria-labelledby="modalNew" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
			<%
				@content_category                 = ContentCategory.new
				@content_category.shop            = @shop
				@content_category.parent          = @parent_category
				@content_category.web_page        = @parent_category.web_page 
				@content_category.category_type   = ContentCategory::TYPE_CATEGORY
			%>
			<%= form_for @content_category, url: admin_content_portfolio_content_category_create_path, method: :post do |f| %>
			<%= hidden_field 'content_category', 'shop_id' %>
			<%= hidden_field 'content_category', 'parent_id' %>
			<%= hidden_field 'content_category', 'web_page_id' %>
			<%= hidden_field 'content_category', 'category_type' %>
                <div class="modal-header">
                    <h5 class="modal-title">新規カテゴリー登録</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
					<div class="mb-3 row">
						<label for="name" class="col-sm-4 col-form-label">カテゴリー</label>
						<div class="col-sm-8">
							<%= f.text_field :title,  {class: "form-control", placeholder: "カテゴリー名称を入力", :required => true, autofocus: true}  %>
						</div>
					</div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success"><%= new_icon('登録') %>&nbsp;登録</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">キャンセル</button>
                </div>
			<% end %>
        </div>
    </div>
</div>

<% if false %>
<!-- Modal -->
<div id="modalNew" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<%= form_tag({:action => 'content_category_create', :parent_id=>@parent_category}, :class=>"form-horizontal", method: :post)  do %>
		<%
		    @item                 = ContentCategory.new
		    @item.shop            = @shop
		    @item.parent          = @parent_category
		    @item.web_page        = @parent_category.web_page 
		    @item.category_type   = ContentCategory::TYPE_CATEGORY
		%>
		<%= hidden_field 'item', 'shop_id' %>
		<%= hidden_field 'item', 'parent_id' %>
		<%= hidden_field 'item', 'web_page_id' %>
		<%= hidden_field 'item', 'category_type' %>

		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			<h3 id="myModalLabel">新規カテゴリー登録</h3>
		</div>
		<div class="modal-body">
			<div class="control-group">
				<label class="control-label" for="item_title">カテゴリー</label>
				<div class="controls controls-row">
					<%= text_field 'item', 'title', :placeholder=>"カテゴリー名称", :autocomplete => "off" %>
				</div>
			</div>
		</div>
		<div class="modal-footer">
			<button type="submit" class="btn btn-success"><i class="icon-plus"></i>&nbsp;&nbsp;登録</button>
			<button class="btn" data-dismiss="modal" aria-hidden="true"><i class="icon-remove"></i>&nbsp;&nbsp;キャンセル</button>
		</div>
	<% end %>
</div>
<% end %>

<% unless @current_category.children.blank? %>
	<h4>サブ・カテゴリー</h4>
	<% array = @current_category.children.in_groups_of(3, false)%>
	<div class="row">
		<% for i in 0..(array.size-1) %>
			<% @lines = array[i] %>
		        <div class="col-sm-4">
		        	<%= render :partial=>"item_category_tree", :locals => {:temp_local => @lines[0]}  if @lines.size>=1 %>
				</div>		
		        <div class="col-sm-4">
		        	<%= render :partial=>"item_category_tree", :locals => {:temp_local => @lines[1]}  if @lines.size>=2 %>
				</div>		
		        <div class="col-sm-4">
		        	<%= render :partial=>"item_category_tree", :locals => {:temp_local => @lines[2]}  if @lines.size>=3 %>
				</div>
		<% end %>
	</div>
<% end %>
